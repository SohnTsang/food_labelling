{% load i18n %}
{% load static %}

<!DOCTYPE html>
<html>
<head>
    <title>{% trans "Create Label Template" %}</title>
    <link rel="stylesheet" href="{% static 'LabelManagement/css/styles.css' %}">

    <!-- Include your CSS files here -->
</head>
<body>
        <h2>{% trans "Create Label Template" %}</h2>
        <form method="post">
        {% csrf_token %}
        <label for="{{ form.product_name.id_for_label }}">{% trans "Product Name" %}</label> {{ form.product_name }} <br><br>
        <label for="{{ form.product_name.id_for_label }}">{% trans "Ingredients" %}</label> <p>{{ form.ingredients }}</p>
        <div id="nutrientInputsContainer" class="nutrient">
            <label for="{{ nutrient_form.name.id_for_label }}">Nutrient Name and</label>
            <label for="{{ nutrient_form.amount.id_for_label }}">Amount</label><br>
        </div> <br>
        <button type="button" id="addNutrientButton">Add More</button> <br><br>
        <!--<label for="{{ form.product_name.id_for_label }}">{% trans "Content" %}</label> {{ form.content }} <br><br>-->
        <label for="content_amount">{% trans "Net Weight" %}</label>
        <input type="text" id="content_amount" name="content_amount" placeholder="Enter amount">
        <!--<label for="content_unit">{% trans "Unit" %}</label>-->
        <select id="content_unit" name="content_unit">
            <option value="g">g</option>
            <option value="mg">mg</option>
        </select><br><br>
        <label for="{{ form.product_name.id_for_label }}">{% trans "Other_info" %}</label> <p>{{ form.other_info }}</p>
        <label for="{{ form.product_name.id_for_label }}">{% trans "Import Country" %}</label> {{ form.import_country }} <br><br>
        <label for="{{ form.product_name.id_for_label }}">{% trans "Sizes" %}</label> <p>{{ form.sizes }}</p>
        <label for="{{ form.product_name.id_for_label }}">{% trans "Expiry Date" %}</label> {{ form.expiry_date }} <br><br>
        <label for="{{ form.product_name.id_for_label }}">{% trans "Instruction" %}</label> <p>{{ form.instruction }}</p>
        <label for="{{ form.company_name.id_for_label }}">{% trans "Company Name" %}</label> {{ form.company_name }} <br><br>
        <label for="{{ form.company_address.id_for_label }}">{% trans "Company Address" %}</label> {{ form.company_address }} <br><br>
        <label for="{{ form.company_email.id_for_label }}">{% trans "Company Email" %}</label> {{ form.company_email }} <br><br>
        <label for="{{ form.company_phone.id_for_label }}">{% trans "Company Phone" %}</label> {{ form.company_phone }} <br><br>

        <br><br>
        <button type="submit">{% trans "Convert" %}</button>
    </form>

    <br>

    <form action="{% url 'set_language' %}" method="post">
        {% csrf_token %}
        <input name="next" type="hidden" value="{{ request.path }}">
        <select name="language" onchange="this.form.submit()">
            <option value="ja"{% if LANGUAGE_CODE == "ja" %} selected{% endif %}>日本語</option>
            <option value="en"{% if LANGUAGE_CODE == "en" %} selected{% endif %}>English</option>
            <!-- Add more language options as needed -->
        </select>
    </form>

    <script>
        document.addEventListener('DOMContentLoaded', function () {
            let container = document.getElementById('nutrientInputsContainer');
            let addButton = document.getElementById('addNutrientButton');

            function saveFormState() {
                let nutrientData = [];
                container.querySelectorAll('div').forEach(div => {
                    let name = div.querySelector('input[name="nutrient_name[]"]').value;
                    let amount = div.querySelector('input[name="nutrient_amount[]"]').value;
                    nutrientData.push({name, amount});
                });
                sessionStorage.setItem('nutrientFormData', JSON.stringify(nutrientData));
            }

            function addNutrientInput(name = '', amount = '') {
                let newFieldHtml = `<div>
                                        <input type="text" name="nutrient_name[]" placeholder="Name" value="${name}">
                                        <input type="text" name="nutrient_amount[]" placeholder="Amount (e.g., 100g, 200kcal)" value="${amount}">
                                        <select id="content_unit" name="nutrient_unit[]">
                                            <option value="g">g</option>
                                            <option value="mg">mg</option>
                                            <option value="mg">kcal</option>
                                            <!-- Add more units as needed -->
                                        </select>
                                    </div>`;
                container.insertAdjacentHTML('beforeend', newFieldHtml);

                container.querySelectorAll('input').forEach(input => {
                    input.addEventListener('change', saveFormState);
                });
            }

            addButton.addEventListener('click', function() {
                addNutrientInput();
            });

            if (performance.navigation.type === performance.navigation.TYPE_RELOAD) {
                sessionStorage.clear();
            }

            // Load saved form data if available
            let savedData = sessionStorage.getItem('nutrientFormData');
                if (savedData) {
                    let nutrientData = JSON.parse(savedData);
                    nutrientData.forEach(data => {
                        addNutrientInput(data.name, data.amount);
                    });
                } else {
                    // Add the first nutrient input by default
                    addNutrientInput();
                }
            });
    </script>

</body>
</html>